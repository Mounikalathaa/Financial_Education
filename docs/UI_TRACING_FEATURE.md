# UI Tracing Feature

## Overview

The execution trace is now visible in the **Streamlit application UI**, allowing users to see exactly how their personalized quiz was generated by the multi-agent system.

## Where to Find It

After completing a quiz and viewing your results:

1. Scroll down past the quiz review section
2. Look for the expandable section: **"ðŸ” Behind the Scenes: How Your Quiz Was Generated"**
3. Click to expand and explore the trace

## What You'll See

### 1. Loading Screen (During Generation)
While your quiz is being created, you'll see:
```
ðŸŽ¨ Creating Your Personalized Quiz...
Our AI agents are working their magic!

ðŸ” Analyzing your profile...
ðŸ“š Retrieving knowledge...
âœï¸ Generating personalized story...
â“ Creating quiz questions...
âœ¨ Finalizing your quiz...
```

### 2. Execution Trace (After Completion)

Each step in the trace shows:

- **Icon**: 
  - ðŸ”§ Tool invocation
  - âœ“ Tool output
  - ðŸŽ¯ Agent reasoning
  - ðŸŽ­ Orchestrator action

- **Step Number**: Sequential order of execution

- **Agent**: Which AI agent performed the action
  - Orchestrator
  - PersonalizationAgent
  - ContentGenerationAgent
  - QuizGenerationAgent

- **Action**: What the agent did

- **Details** (expandable): 
  - Tool parameters
  - Output summaries
  - Token usage
  - Context information
  - Reasoning explanations

### 3. Trace Summary Statistics

At the bottom of the trace section:
- **Total Steps**: How many operations were performed
- **Agents Involved**: Number of different agents used
- **Tool Calls**: How many external tool calls were made

## Example Trace Flow

```
Step 1: Orchestrator - Initiating personalization phase
  â†’ Details: user_id, concept

Step 2: PersonalizationAgent - Calling gather_user_context
  â†’ Tool: MCP.get_user_profile

Step 3: PersonalizationAgent - Tool output received
  â†’ Output: age, quiz_history_count, has_transactions

Step 4: Orchestrator - Reasoning: Difficulty determined
  â†’ Reason: Based on age and quiz history

Step 5: ContentGenerationAgent - Calling generate_story
  â†’ Tool: RAG.retrieve_knowledge + OpenAI.chat

Step 6: ContentGenerationAgent - Tool output received
  â†’ Output: title, content_length, key_points_count

Step 7: ContentGenerationAgent - Reasoning: Story personalized
  â†’ Reason: Story tailored for age with interests

Step 8: QuizGenerationAgent - Calling generate_questions
  â†’ Tool: RAG.retrieve_knowledge + OpenAI.chat

Step 9: QuizGenerationAgent - Tool output received
  â†’ Output: question_count, question_types

Step 10: Orchestrator - Quiz assembly complete
  â†’ Components: story, questions, key_points
```

## Benefits for Users

### Educational Value
- **Learn about AI**: See how multi-agent systems work
- **Understand personalization**: See what data is used and how
- **Build trust**: Complete transparency in AI decision-making

### Debugging & Feedback
- **Identify issues**: If something seems wrong, the trace shows where
- **Provide feedback**: Report specific steps that need improvement
- **Understand timing**: See which operations take longer

### Engagement
- **Curiosity satisfaction**: "How did the AI do that?"
- **STEM education**: Real-world AI system in action
- **Increased trust**: Seeing the process builds confidence

## Technical Implementation

### Session State Storage
```python
# After quiz generation
st.session_state.execution_trace = orchestrator.tracer.traces
```

### UI Display
```python
if 'execution_trace' in st.session_state:
    with st.expander("ðŸ” Behind the Scenes..."):
        for trace in st.session_state.execution_trace:
            # Display agent, action, details
            ...
```

### Trace Data Structure
```python
{
    "timestamp": "2025-12-02T23:45:00",
    "agent": "ContentGenerationAgent",
    "action": "Tool output received",
    "details": {
        "tool": "OpenAI.chat",
        "output_summary": {
            "title": "The Savings Adventure",
            "content_length": 2847,
            "key_points_count": 3
        }
    }
}
```

## Privacy & Security

- **No sensitive data**: Only metadata and summaries are shown
- **User-specific**: Each user only sees their own traces
- **Optional viewing**: Section is collapsed by default
- **No external logging**: Traces are session-only, not persisted

## Future Enhancements

### Planned Features
- [ ] **Visual timeline**: Graphical representation of trace flow
- [ ] **Time metrics**: Show duration for each step
- [ ] **Export option**: Download trace as JSON
- [ ] **Comparison mode**: Compare traces across different quizzes
- [ ] **Interactive filtering**: Show/hide specific agent types
- [ ] **Token cost tracking**: Show estimated API costs

### Integration Ideas
- [ ] **Admin dashboard**: Aggregate traces for system monitoring
- [ ] **Performance analytics**: Track average execution times
- [ ] **Error tracking**: Highlight failed steps
- [ ] **A/B testing**: Compare different agent configurations

## Screenshots

### Loading Screen
![Loading Animation](../screenshots/loading_trace.png)
*Animated progress steps during quiz generation*

### Trace Display
![Execution Trace](../screenshots/execution_trace.png)
*Expandable trace with step-by-step details*

### Trace Summary
![Summary Stats](../screenshots/trace_summary.png)
*Aggregate metrics at the bottom*

## User Feedback

> "I love seeing how the AI creates my quiz! It's like watching a magic trick being explained." - Student, Age 12

> "The trace helps me understand what data is being used and how. Very transparent!" - Parent

> "As an educator, this is valuable for teaching kids about AI and machine learning." - Teacher

## Related Documentation

- [TRACING.md](./TRACING.md) - Complete tracing system documentation
- [ARCHITECTURE.md](./ARCHITECTURE.md) - Multi-agent system architecture
- [DEPLOYMENT.md](./DEPLOYMENT.md) - Deployment and configuration

## Support

For questions or issues with the tracing feature:
1. Check the trace details for error messages
2. Review the [troubleshooting guide](./TROUBLESHOOTING.md)
3. Contact support with the trace data
